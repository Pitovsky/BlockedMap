<!doctype html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Карта РосКомПозора</title>
        <meta name="viewport" content="initial-scale=1.0, width=device-width">

        <link rel="stylesheet" type="text/css" href="https://js.api.here.com/v3/3.0/mapsjs-ui.css" />
        <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script>
        <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script>
        <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script>
        <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>
        <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/1/jquery.min.js"></script>
        <script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>

        <script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
        <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />

        <link rel="stylesheet" href={{ url_for("static", filename="css/app.css") }}>
        <link rel="stylesheet" href={{ url_for("static", filename="css/bootstrap.min.css") }}>
    </head>
    <body>
        <div class="row" style="margin-top: 60px">
          <div class="col-md-9">
              <div id="map-container" class="map"></div>
              <form action="/filter_time" method="post">
                <div class="row">
                  <div class="col-md-11">
                      <div class="slidecontainer">
                        <input type="range" min="1353756857" max="1524232055" value="1353756857" step="1" class="slider" id="timelapse1">
                        <input type="range" min="1353756857" max="1524232055" value="1524232055" step="1" class="slider" id="timelapse2">
                      </div>
                  </div>
                </div>
              </form>
          </div>

          <div class="col-md-2">
            <div class="card" style="width: 25rem;">
              <div class="card-body">
               <form action="/filter" method="post">
                  <fieldset class="form-group">
                      <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" id="FNS" name="FNS">
                          <label class="custom-control-label" for="FNS">ФНС</label>
                      </div>
                      <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" id="COURT" name="COURT">
                          <label class="custom-control-label" for="COURT">Суд</label><br>
                      </div>
                      <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" id="GP" name="GP">
                          <label class="custom-control-label" for="GP">Генпрокуратура</label>
                      </div>
                      <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" id="RKN" name="RKN">
                          <label class="custom-control-label" for="RKN">Роскомнадзор</label>
                      </div>
                      <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" id="MVD" name="MVD">
                          <label class="custom-control-label" for="MVD">МВД</label>
                      </div>
                      <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" id="FSKN" name="FSKN">
                          <label class="custom-control-label" for="FSKN">ФСКН</label>
                      </div>
                      <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" id="MGCOURT" name="MGCOURT">
                          <label class="custom-control-label" for="MGCOURT">Мосгорсуд</label>
                      </div>
                      <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" id="RPN" name="RPN">
                          <label class="custom-control-label" for="RPN">Роспотребнадзор</label>
                      </div>
                      <div class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" id="MKS" name="MKS">
                          <label class="custom-control-label" for="MKS">Минкомсвязь</label>
                      </div>
                  </fieldset>
                    <div id="reportrange" name="reportrange" class="input-group mb-3"" style="background: #fff; cursor: pointer; padding: 2px 2px; width: 100%">
                        <div class="input-group">
                            <span class="input-group-addon" id="calendar"><span class="glyphicon glyphicon-calendar fa fa-calendar"><b class="caret"></b></span></span>
                        </div>
                        <input name="range" type="text" class="form-control"></input>
                    </div>
                    <br>
                  <input type="submit" class="btn btn-info" id="submit_orgs" value="Фильтровать">
                </form>
              </div>
            </div>
          </div>
        </div>

        <script type="text/javascript">
          var mapContainer = document.getElementById('map-container');

          var platform = new H.service.Platform({
            app_id: 'o8laThovktF2GpayPtsu',
            app_code: 'gzc292l_SP7HGieBMAxCtw',
          });

          var MoscowCoordinates = {
            lat: 55.7558,
            lng: 37.6173
          };

          var mapOptions = {
            zoom: 2,
            height: 600,
            width: 900
          };

          var defaultLayers = platform.createDefaultLayers();

          var map = new H.Map(
            mapContainer,
            defaultLayers.normal.map,
            mapOptions);

          map.addObject(new H.map.Marker(MoscowCoordinates));

          // var customStyle = {
          //   strokeColor: 'black',
          //   fillColor: 'rgba(170, 85, 0, 0.5',
          //   lineWidth: 10,
          //   lineCap: 'circle',
          //   lineJoin: 'bevel'
          // };

          {% for point in points %}
          map.addObject(
            new H.map.Circle(
              { lat: {{point[1]}}, lng: {{point[0]}} }, 32000*Math.log({{point[2]}})*Math.cos((180 / Math.PI)*{{point[1]}}),
              {style: {fillColor: 'rgba(200, 10, 0, 0.5', strokeColor: 'black'}})
            )
          {% endfor %}

          window.addEventListener('resize', function () {
            map.getViewPort().resize();
          });

          var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
          var ui = H.ui.UI.createDefault(map, defaultLayers);
        </script>

        <script src={{ url_for("static", filename="js/bootstrap.min.js") }}></script>
        <script type="text/javascript">
        $(function() {

            var start = moment().subtract(29, 'days');
            var end = moment();

            function cb(start, end) {
                $('#reportrange input').val(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            }

            $('#reportrange').daterangepicker({
                startDate: start,
                endDate: end,
                ranges: {
                   'Today': [moment(), moment()],
                   'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                   'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                   'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                   'This Month': [moment().startOf('month'), moment().endOf('month')]
                }
            }, cb);

            cb(start, end);
            
        });
        </script>
    </body>
</html>
